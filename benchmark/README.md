# Kotlin Avro Benchmark

This project contains a benchmark that compares the serialization / deserialization performance of the following avro libraries:

- [Avro4k](https://github.com/avro-kotlin/avro4k/)
- [Jackson Avro](https://github.com/FasterXML/jackson-dataformats-binary/tree/master/avro)
- [Avro (using ReflectData)](https://avro.apache.org/)

Each benchmark is executed with the following configuration:
- Reading from a prepared byte array
- Writing to a null output stream
- All with the exact same schema generated by avro4k
- Generating a maximum of use cases:
  - nullable fields
  - unions
  - arrays
  - records
  - enums
  - primitives (string, int, float, double, boolean)
  - logical types (date, timestamp-millis, char, uuid)
- not benchmarking uuid as jackson uses a different representation (fixed) than avro4k and apache avro (string)

## Results

Computer: Macbook air M2

```
Benchmark                                                       Mode   Cnt     Score       Error   Units
ApacheAvroReflectBenchmark.read            thrpt    5  28819.641 ± 1048.236  ops/s
Avro4kBenchmark.read                       thrpt    5  27259.164 ±  418.829  ops/s
Avro4kGenericWithApacheAvroBenchmark.read  thrpt    5  16242.380 ±  123.109  ops/s

Avro4kBenchmark.write                       thrpt    5  55760.544 ±  394.596  ops/s
ApacheAvroReflectBenchmark.write            thrpt    5  48015.770 ± 4021.317  ops/s
JacksonAvroBenchmark.write                  thrpt    5  34701.945 ±  719.865  ops/s
Avro4kGenericWithApacheAvroBenchmark.write  thrpt    5  23859.446 ± 3207.023  ops/s

Avro4kSimpleBenchmark.read                       thrpt    5  224766.920 ± 21004.000  ops/s
ApacheAvroReflectSimpleBenchmark.read            thrpt    5  214986.578 ± 23138.102  ops/s
Avro4kGenericWithApacheAvroSimpleBenchmark.read  thrpt    5  146503.504 ±  2613.945  ops/s
JacksonAvroSimpleBenchmark.read                  thrpt    5   66071.428 ±  1571.426  ops/s

Avro4kSimpleBenchmark.write                       thrpt    5  448433.701 ±  2086.119  ops/s
ApacheAvroReflectSimpleBenchmark.write            thrpt    5  245640.080 ±  3835.344  ops/s
Avro4kGenericWithApacheAvroSimpleBenchmark.write  thrpt    5  158308.148 ± 12314.688  ops/s
JacksonAvroSimpleBenchmark.write                  thrpt    5  125374.072 ±  5240.116  ops/s

JacksonAvroListsBenchmark.read                  thrpt    5  6.329 ± 0.631  ops/s
Avro4kListsBenchmark.read                       thrpt    5  5.074 ± 1.624  ops/s
ApacheAvroReflectListsBenchmark.read            thrpt    5  4.048 ± 0.366  ops/s
Avro4kGenericWithApacheAvroListsBenchmark.read  thrpt    5  3.709 ± 1.694  ops/s

ApacheAvroReflectListsBenchmark.write            thrpt    5  7.332 ± 0.532  ops/s
Avro4kListsBenchmark.write                       thrpt    5  6.074 ± 0.087  ops/s
JacksonAvroListsBenchmark.write                  thrpt    5  3.590 ± 1.973  ops/s
Avro4kGenericWithApacheAvroListsBenchmark.write  thrpt    5  3.406 ± 0.900  ops/s

```

> [!WARNING]
> JacksonAvroBenchmark.read is failing because of a bug in the library when combining kotlin and avro format.

> [!NOTE]
> To add the relative difference, just ask to chatgpt "can you add another column in this benchmark that indicates the relative difference in percent regarding
> Avro4kDirectBenchmark:"

## Run the benchmark locally

Just execute the benchmark:

```shell
../gradlew benchmark
```

You can get the results in the `build/reports/benchmarks/main` directory.

## Other information

Thanks for [@twinprime](https://github.com/twinprime) for this initiative.
