# Kotlin Avro Benchmark

This project contains a benchmark that compares the serialization / deserialization performance of the following avro libraries:

- [Avro4k](https://github.com/avro-kotlin/avro4k/)
- [Jackson Avro](https://github.com/FasterXML/jackson-dataformats-binary/tree/master/avro)
- [Avro (using ReflectData)](https://avro.apache.org/)

Each benchmark is executed with the following configuration:
- Reading from a prepared byte array
- Writing to a null output stream
- All with the exact same schema generated by avro4k
- Generating a maximum of use cases:
  - nullable fields
  - unions
  - arrays
  - records
  - enums
  - primitives (string, int, float, double, boolean)
  - logical types (date, timestamp-millis, char, uuid)
- not benchmarking uuid as jackson uses a different representation (fixed) than avro4k and apache avro (string)

## Results

Computer: Macbook air M2

```
Benchmark                                               Mode  Cnt       Score       Error  Units
c.g.a.b.complex.ApacheAvroReflectBenchmark.read        thrpt    5   28547.385 ±  1650.012  ops/s
c.g.a.b.complex.Avro4kBenchmark.read                   thrpt    5   26632.851 ±  1234.999  ops/s

c.g.a.b.complex.ApacheAvroReflectBenchmark.write       thrpt    5   48233.161 ±  2802.632  ops/s
c.g.a.b.complex.Avro4kBenchmark.write                  thrpt    5   40242.128 ±   959.712  ops/s
c.g.a.b.complex.JacksonAvroBenchmark.write             thrpt    5   35803.795 ±   690.634  ops/s

c.g.a.b.simple.Avro4kSimpleBenchmark.read              thrpt    5  248421.898 ±  2784.662  ops/s
c.g.a.b.simple.ApacheAvroReflectSimpleBenchmark.read   thrpt    5  216567.573 ±  8266.148  ops/s
c.g.a.b.simple.JacksonAvroSimpleBenchmark.read         thrpt    5   63937.063 ±   708.020  ops/s

c.g.a.b.simple.Avro4kSimpleBenchmark.write             thrpt    5  299860.558 ±  1371.411  ops/s
c.g.a.b.simple.ApacheAvroReflectSimpleBenchmark.write  thrpt    5  239041.443 ± 21416.197  ops/s
c.g.a.b.simple.JacksonAvroSimpleBenchmark.write        thrpt    5  127574.224 ±  5285.247  ops/s

c.g.a.b.lists.JacksonAvroListsBenchmark.read           thrpt    5       7.927 ±     0.931  ops/s
c.g.a.b.lists.Avro4kListsBenchmark.read                thrpt    5       6.562 ±     0.237  ops/s
c.g.a.b.lists.ApacheAvroReflectListsBenchmark.read     thrpt    5       4.715 ±     0.195  ops/s

ApacheAvroReflectListsBenchmark.write                  thrpt    5       9.776 ±     1.560  ops/s
Avro4kListsBenchmark.write                             thrpt    5       8.329 ±     0.122  ops/s
JacksonAvroListsBenchmark.write                        thrpt    5       5.892 ±     0.217  ops/s
```

> [!WARNING]
> JacksonAvroBenchmark.read is failing because of a bug in the library when combining kotlin and avro format.

> [!NOTE]
> To add the relative difference, just ask to chatgpt "can you add another column in this benchmark that indicates the relative difference in percent regarding
> Avro4kDirectBenchmark:"

## Run the benchmark locally

Just execute the benchmark:

```shell
../gradlew benchmark
```

You can get the results in the `build/reports/benchmarks/main` directory.

## Other information

Thanks for [@twinprime](https://github.com/twinprime) for this initiative.
